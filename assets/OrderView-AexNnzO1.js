import{r as l,w as I,o as r,c as d,a as b,b as o,e as i,v as m,i as C,F as D,j as V,f as P,t as S,g as U,l as v,h as O}from"./index-vYOaRHlJ.js";import{a as w}from"./axios-Cm0UX6qg.js";const q={key:0,class:"flex items-center justify-center m-auto pt-10"},T={key:1,class:"flex items-center justify-center flex-col p-10 text-center"},M=o("label",{for:"name"},"姓名",-1),j=o("label",{for:"phone"},"您的電話號碼",-1),F=o("label",{for:"issue"},"看診問題/備註事項",-1),R=o("label",{for:"doctor"},"約診醫生",-1),A=o("label",{for:"department"},"科別",-1),B=["value"],H=o("label",{for:"date"},"就診日",-1),$=o("label",{for:"notes"},"備註欄,或其他您方便約診的時間",-1),L=["disabled"],G={key:0},W={key:1},K={key:2,class:"flex items-center justify-center flex-col p-10 text-center"},Y=o("h1",{class:"text-2xl font-bold text-center"},"您尚未設定本裝置",-1),Z={key:3,class:"flex items-center justify-center flex-col p-10 text-center"},z=o("p",null,"已完成預約",-1),X={__name:"Order",props:["userid"],setup(y){const n=y,u=l(null);console.log("userID",n.userid);const x=l(""),p=l(!1),c=l(!1);l(!1);const f=l(!0);l(!1),l(!1),l(!1),l(!1);const h=l(!1),_=l(!1),k=["ANES/麻醉疼痛科","BS/乳房外科","CM/胸腔內科","CVS/心臟血管外科","CRS/直腸外科","CS/胸腔外科","DERM/皮膚科","CV/心臟內科","Diet/營養諮詢","ENT/耳鼻喉科","FM/家庭醫學科","GI/胃腸肝膽科","GS/一般外科","GU/泌尿外科","OBGY/婦產科","HEMA/血液腫瘤科","NS/神經外科","INF/感染科","META/新陳代謝科","NEPH/腎臟內科","NEUR/神經內科","OPH/眼科","ORTH/骨科","PED/小兒科","PS/整形外科","PSY/精神科","REHA/復健科","IMRH/風濕免疫科","CADP/腹膜透析","心理諮商","PEDS/小兒外科"],t=l({method:"addOrder",personName:"",personPhone:"",issue:"",doctor:"",department:"",orderDate:"",notes:""});let g=null;const E=()=>{g&&clearTimeout(g),g=setTimeout(()=>{const a=new FormData;a.append("method","addOrder"),a.append("userid",n.userid),a.append("personName",t.value.personName),a.append("issue",t.value.issue),a.append("doctor",t.value.doctor),a.append("personPhone",t.value.personPhone),a.append("department",t.value.department),a.append("orderDate",t.value.orderDate),a.append("notes",t.value.notes),h.value=!0,w({method:"post",url:"https://fju-line-app.herokuapp.com/infolinebot/add_order",data:a,headers:{Origin:"https://liff.line.me"}}).then(e=>{h.value=!1,u.value=e.data,console.log(e),f.value=!1,p.value=!1,_.value=!0}).catch(e=>{alert("預約失敗，請稍後再試或聯絡診所"),console.log(e)})},2e3)},N=()=>{const a=new FormData;a.append("method","checkUserIDisExist"),a.append("userid",n.userid),console.log(a.get("userid")),w({method:"post",url:"https://script.google.com/macros/s/AKfycbxv0X4hKmjRsqICHL8WTa4nqpql6Rbq9w1njra_4jcFN-OcbZ4zxARyuyN9h2PCvvnB/exec",data:a,headers:{"Content-Type":"text/plain; charset=utf-8"}}).then(e=>{console.log(e),e.data.result==="useridisexist"?(x.value=e.data.personid,u.value=e.data,p.value=!0):(p.value=!1,c.value=!0,u.value=e.data),f.value=!1}).catch(e=>{console.log(e),u.value=e.data})};return I(n,(a,e)=>{console.log("user.userid",n.userid),N()}),(a,e)=>(r(),d(D,null,[f.value?(r(),d("div",q," 讀取中 ")):b("",!0),p.value?(r(),d("div",T,[o("form",{class:"flex flex-col items-center p-4",onSubmit:e[7]||(e[7]=P(s=>E(),["prevent"]))},[M,i(o("input",{type:"text",id:"name","onUpdate:modelValue":e[0]||(e[0]=s=>t.value.personName=s),class:"border border-gray-300 rounded-md p-2",required:"required"},null,512),[[m,t.value.personName]]),j,i(o("input",{class:"border border-gray-300 rounded-md p-2",type:"text",id:"phone","onUpdate:modelValue":e[1]||(e[1]=s=>t.value.personPhone=s),required:"required",pattern:"[0-9]+"},null,512),[[m,t.value.personPhone]]),F,i(o("textarea",{class:"border border-gray-300 rounded-md p-2",id:"issue","onUpdate:modelValue":e[2]||(e[2]=s=>t.value.issue=s)},null,512),[[m,t.value.issue]]),R,i(o("input",{class:"border border-gray-300 rounded-md p-2",type:"text",id:"doctor","onUpdate:modelValue":e[3]||(e[3]=s=>t.value.doctor=s)},null,512),[[m,t.value.doctor]]),A,i(o("select",{class:"border border-gray-300 rounded-md p-2",id:"department","onUpdate:modelValue":e[4]||(e[4]=s=>t.value.department=s),required:""},[(r(),d(D,null,V(k,s=>o("option",{value:s,key:s},S(s),9,B)),64))],512),[[C,t.value.department]]),H,i(o("input",{class:"border border-gray-300 rounded-md p-2",type:"date",id:"date","onUpdate:modelValue":e[5]||(e[5]=s=>t.value.orderDate=s),required:"required"},null,512),[[m,t.value.orderDate]]),$,i(o("textarea",{class:"border border-gray-300 rounded-md p-2",id:"notes","onUpdate:modelValue":e[6]||(e[6]=s=>t.value.notes=s)},null,512),[[m,t.value.notes]]),o("button",{type:"submit",class:"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded",disabled:h.value},[h.value?(r(),d("span",G,"送出中...")):(r(),d("span",W,"送出"))],8,L)],32)])):b("",!0),c.value?(r(),d("div",K,[Y,o("button",{onClick:e[8]||(e[8]=s=>a.$router.push("/"))},"前往設定")])):b("",!0),_.value?(r(),d("div",Z,[z,o("button",{onClick:e[9]||(e[9]=s=>a.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認")])):b("",!0)],64))}},J={class:"text-xl"},te={__name:"OrderView",setup(y){const n=l(!1),u=l(null),x=l(null);U(async()=>{v.init({liffId:"1657869644-x3BZd5wE"}).then(()=>{v.isLoggedIn()&&(n.value=v.isLoggedIn(),u.value=v.getDecodedIDToken().sub,x.value=v.getDecodedIDToken().email)}).catch(c=>{console.log(c.code,c.message)})});const p=()=>{v.closeWindow()};return(c,f)=>(r(),d("div",J,[O(X,{onCloseWindow:p,userid:u.value},null,8,["userid"])]))}};export{te as default};
