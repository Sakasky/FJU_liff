import{r as a,w as I,o as n,c as d,a as r,b as t,e as c,v,j as V,F as D,k as S,d as U,f as _,t as T,h as O,l as b,i as M}from"./index-B8s-YdhV.js";import{a as N}from"./axios-Cm0UX6qg.js";const R={key:0,class:"flex items-center justify-center m-auto pt-10"},j={key:1,class:"flex items-center justify-center flex-col p-10 text-center"},q={class:"mb-4 w-full text-left"},F=t("label",{for:"name",class:"block font-bold mb-1"},[_("姓名"),t("span",{class:"text-red-500"},"*")],-1),A={key:0,class:"text-red-500 text-xs mt-1"},B={class:"mb-4 w-full text-left"},H=t("label",{for:"phone",class:"block font-bold mb-1"},[_("您的電話號碼"),t("span",{class:"text-red-500"},"*")],-1),$={key:0,class:"text-red-500 text-xs mt-1"},L={class:"mb-4 w-full text-left"},G=t("label",{for:"issue",class:"block font-bold mb-1"},"看診問題/備註事項",-1),W={class:"mb-4 w-full text-left"},K=t("label",{for:"doctor",class:"block font-bold mb-1"},"約診醫生",-1),Y={class:"mb-4 w-full text-left"},Z=t("label",{for:"department",class:"block font-bold mb-1"},[_("科別"),t("span",{class:"text-red-500"},"*")],-1),z=t("option",{value:"",disabled:""},"請選擇科別",-1),X=["value"],J={key:0,class:"text-red-500 text-xs mt-1"},Q={class:"mb-4 w-full text-left"},ee=t("label",{for:"date",class:"block font-bold mb-1"},[_("就診日"),t("span",{class:"text-red-500"},"*")],-1),te={key:0,class:"text-red-500 text-xs mt-1"},se={class:"mb-4 w-full text-left"},oe=t("label",{for:"notes",class:"block font-bold mb-1"},"備註欄,或其他您方便約診的時間",-1),le=["disabled"],ae={key:0},ne={key:1},de={key:2,class:"flex items-center justify-center flex-col p-10 text-center"},re=t("h1",{class:"text-2xl font-bold text-center"},"您尚未設定本裝置",-1),ue={key:3,class:"flex items-center justify-center flex-col p-10 text-center"},ie=t("p",null,"已完成預約",-1),ce={__name:"Order",props:["userid"],setup(y){const u=y,i=a(null);console.log("userID",u.userid);const w=a(""),p=a(!1),f=a(!1);a(!1);const x=a(!0);a(!1),a(!1),a(!1),a(!1);const h=a(!1),k=a(!1),E=["ANES/麻醉疼痛科","BS/乳房外科","CM/胸腔內科","CVS/心臟血管外科","CRS/直腸外科","CS/胸腔外科","DERM/皮膚科","CV/心臟內科","Diet/營養諮詢","ENT/耳鼻喉科","FM/家庭醫學科","GI/胃腸肝膽科","GS/一般外科","GU/泌尿外科","OBGY/婦產科","HEMA/血液腫瘤科","NS/神經外科","INF/感染科","META/新陳代謝科","NEPH/腎臟內科","NEUR/神經內科","OPH/眼科","ORTH/骨科","PED/小兒科","PS/整形外科","PSY/精神科","REHA/復健科","IMRH/風濕免疫科","CADP/腹膜透析","心理諮商","PEDS/小兒外科"],s=a({method:"addOrder",personName:"",personPhone:"",issue:"",doctor:"",department:"",orderDate:"",notes:""});let g=null;const m=a(!1),P=()=>{if(m.value=!1,!s.value.personName||!s.value.personPhone||!s.value.department||!s.value.orderDate){m.value=!0;return}g&&clearTimeout(g),g=setTimeout(()=>{const l=new URLSearchParams;l.append("method","addOrder"),l.append("userid",u.userid),l.append("personName",s.value.personName),l.append("issue",s.value.issue),l.append("doctor",s.value.doctor),l.append("personPhone",s.value.personPhone),l.append("department",s.value.department),l.append("orderDate",s.value.orderDate),l.append("notes",s.value.notes||""),h.value=!0,N({method:"post",url:"https://fju-line-app.herokuapp.com/infolinebot/add_order",data:l,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{h.value=!1,i.value=e.data,x.value=!1,p.value=!1,k.value=!0}).catch(e=>{let o="預約失敗，請稍後再試或聯絡診所";e.response.data&&(o=e.response.data.message),alert(o),console.log(e)})},2e3)},C=()=>{const l=new FormData;l.append("method","checkUserIDisExist"),l.append("userid",u.userid),console.log(l.get("userid")),N({method:"post",url:"https://script.google.com/macros/s/AKfycbxv0X4hKmjRsqICHL8WTa4nqpql6Rbq9w1njra_4jcFN-OcbZ4zxARyuyN9h2PCvvnB/exec",data:l,headers:{"Content-Type":"text/plain; charset=utf-8"}}).then(e=>{console.log(e),e.data.result==="useridisexist"?(w.value=e.data.personid,i.value=e.data,p.value=!0):(p.value=!1,f.value=!0,i.value=e.data),x.value=!1}).catch(e=>{console.log(e),i.value=e.data})};return I(u,(l,e)=>{console.log("user.userid",u.userid),C()}),(l,e)=>(n(),d(D,null,[x.value?(n(),d("div",R," 讀取中 ")):r("",!0),p.value?(n(),d("div",j,[t("form",{class:"flex flex-col items-center p-4 bg-white shadow-lg rounded-lg w-full max-w-md",onSubmit:e[7]||(e[7]=U(o=>P(),["prevent"]))},[t("div",q,[F,c(t("input",{type:"text",id:"name","onUpdate:modelValue":e[0]||(e[0]=o=>s.value.personName=o),class:"border border-gray-300 rounded-md p-2 w-full focus:border-blue-500 focus:outline-none",required:""},null,512),[[v,s.value.personName]]),m.value&&!s.value.personName?(n(),d("p",A,"請輸入姓名")):r("",!0)]),t("div",B,[H,c(t("input",{class:"border border-gray-300 rounded-md p-2 w-full focus:border-blue-500 focus:outline-none",type:"text",id:"phone","onUpdate:modelValue":e[1]||(e[1]=o=>s.value.personPhone=o),required:"",pattern:"[0-9]+"},null,512),[[v,s.value.personPhone]]),m.value&&!s.value.personPhone?(n(),d("p",$,"請輸入電話號碼")):r("",!0)]),t("div",L,[G,c(t("textarea",{class:"border border-gray-300 rounded-md p-2 w-full focus:border-blue-500 focus:outline-none",id:"issue","onUpdate:modelValue":e[2]||(e[2]=o=>s.value.issue=o)},null,512),[[v,s.value.issue]])]),t("div",W,[K,c(t("input",{class:"border border-gray-300 rounded-md p-2 w-full focus:border-blue-500 focus:outline-none",type:"text",id:"doctor","onUpdate:modelValue":e[3]||(e[3]=o=>s.value.doctor=o)},null,512),[[v,s.value.doctor]])]),t("div",Y,[Z,c(t("select",{class:"border border-gray-300 rounded-md p-2 w-full focus:border-blue-500 focus:outline-none",id:"department","onUpdate:modelValue":e[4]||(e[4]=o=>s.value.department=o),required:""},[z,(n(),d(D,null,S(E,o=>t("option",{value:o,key:o},T(o),9,X)),64))],512),[[V,s.value.department]]),m.value&&!s.value.department?(n(),d("p",J,"請選擇科別")):r("",!0)]),t("div",Q,[ee,c(t("input",{class:"border border-gray-300 rounded-md p-2 w-full focus:border-blue-500 focus:outline-none",type:"date",id:"date","onUpdate:modelValue":e[5]||(e[5]=o=>s.value.orderDate=o),required:""},null,512),[[v,s.value.orderDate]]),m.value&&!s.value.orderDate?(n(),d("p",te,"請選擇就診日")):r("",!0)]),t("div",se,[oe,c(t("textarea",{class:"border border-gray-300 rounded-md p-2 w-full focus:border-blue-500 focus:outline-none",id:"notes","onUpdate:modelValue":e[6]||(e[6]=o=>s.value.notes=o)},null,512),[[v,s.value.notes]])]),t("button",{type:"submit",class:"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition",disabled:h.value},[h.value?(n(),d("span",ae,"送出中...")):(n(),d("span",ne,"送出"))],8,le)],32)])):r("",!0),f.value?(n(),d("div",de,[re,t("button",{onClick:e[8]||(e[8]=o=>l.$router.push("/"))},"前往設定")])):r("",!0),k.value?(n(),d("div",ue,[ie,t("button",{onClick:e[9]||(e[9]=o=>l.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認")])):r("",!0)],64))}},pe={class:"text-xl"},ve={__name:"OrderView",setup(y){const u=a(!1),i=a(null),w=a(null);O(async()=>{b.init({liffId:"1657869644-x3BZd5wE"}).then(()=>{b.isLoggedIn()&&(u.value=b.isLoggedIn(),i.value=b.getDecodedIDToken().sub,w.value=b.getDecodedIDToken().email)}).catch(f=>{console.log(f.code,f.message)})});const p=()=>{b.closeWindow()};return(f,x)=>(n(),d("div",pe,[M(ce,{onCloseWindow:p,userid:i.value},null,8,["userid"])]))}};export{ve as default};
