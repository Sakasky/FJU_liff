import{r as l,w as F,o as u,c as d,a as m,b as t,d as i,t as P,e as g,v as k,f as T,F as U,g as q,l as v,h as E}from"./index-Csl9Fb9U.js";import{a as b}from"./axios-Cm0UX6qg.js";const N={key:0,class:"flex items-center justify-center m-auto pt-10"},z={key:1,class:"flex items-center justify-center flex-col p-10 text-center"},Z=t("p",null,"本裝置已經設定過",-1),A={class:"text-blue-500"},M=t("p",null,[i("若需要預約請填寫"),t("a",{class:"text-blue-500 underline",href:"https://liff.line.me/1657869644-Z9PmDXzq"},"預約單")],-1),B={key:2,class:"flex items-center justify-center flex-col p-10 text-center"},L=t("h1",{class:"text-2xl font-bold text-center"},"問卷調查",-1),S=t("p",null,"歡迎您申請本系統👇 ",-1),W=t("p",null,"您的裝置尚未設定過身分證驗證 ",-1),X=t("p",null,"請直接輸入身分證號進行驗證(請使用大寫字母)",-1),H=t("label",{for:"name",class:"block mt-4"},[i("請問您的身分證號："),t("span",{class:"text-red-500 text-sm"},"＊")],-1),G=t("button",{type:"submit",class:"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded"},"送出",-1),J={key:3,class:"flex items-center justify-center flex-col p-10 text-center"},K=t("h1",{class:"text-2xl font-bold text-center"},"確認",-1),O={class:"text-blue-500"},Q={key:4,class:"flex items-center justify-center flex-col p-10 text-center"},R=t("h1",{class:"text-2xl font-bold text-center"},"基本資料與綁定裝置",-1),Y={key:5,class:"flex items-center justify-center flex-col p-10 text-center"},ee=t("p",null,"本裝置完成綁定",-1),te=t("p",null,[i("若需要預約請填寫"),t("a",{class:"text-blue-500 underline",href:"https://liff.line.me/1657869644-Z9PmDXzq"},"預約單")],-1),se={key:6,class:"flex items-center justify-center flex-col p-10 text-center"},le=t("p",null,"本裝置完成綁定",-1),oe=t("p",null,[i("若需要預約請填寫"),t("a",{class:"text-blue-500 underline",href:"https://liff.line.me/1657869644-Z9PmDXzq"},"預約單")],-1),ne={__name:"Survey",props:["userid"],setup(D){const n=D,c=l(null);console.log("userID",n);const a=l(""),p=l(""),f=l(""),x=l(!1),y=l(!1),h=l(!1),r=l(!0);l(!1);const _=l(!1),w=l(!1),I=l(!1),V=()=>{const s=new FormData;s.append("personid",a.value),s.append("userid",n.userid),r.value=!0,y.value=!1,b({method:"post",url:"https://fju-line-app.herokuapp.com/infolinebot/check_person_exists",data:s,headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log("response",e),e.data.result==="personidisexist"?(c.value=e.data,r.value=!1,h.value=!0,p.value=e.data.personname):(r.value=!1,h.value=!1,_.value=!0)}).catch(e=>{console.log(e)})},C=()=>{const s=new FormData;s.append("method","addPersonVIP"),s.append("personid",a.value),s.append("userid",n.userid),r.value=!0,h.value=!1,b({method:"post",url:"https://fju-line-app.herokuapp.com/infolinebot/add_person_vip",data:s,headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e.data),r.value=!1,I.value=!0}).catch(e=>{console.log(e)})},$=()=>{if(!p.value||!f.value){alert("請輸入姓名與電話");return}const s=new FormData;s.append("method","addPersonID"),s.append("personname",p.value),s.append("personphone",f.value),s.append("personid",a.value),s.append("userid",n.userid),r.value=!0,_.value=!1,b({method:"post",url:"https://fju-line-app.herokuapp.com/infolinebot/add_person_info",data:s,headers:{"Content-Type":"multipart/form-data"}}).then(e=>{c.value=e.data,console.log(e),r.value=!1,w.value=!0}).catch(e=>{console.log(e)})},j=()=>{const s=new FormData;s.append("userid",n.userid),b({method:"post",url:"https://fju-line-app.herokuapp.com/infolinebot/check_user_registered",data:s,headers:{"Content-Type":"multipart/form-data"}}).then(e=>{e.data.result==="useridisexist"?(a.value=e.data.personid,c.value=e.data,console.log("personID",a),x.value=!0):(x.value=!1,y.value=!0,c.value=e.data),r.value=!1}).catch(e=>{console.log(e),c.value=e.data})};return F(n,(s,e)=>{console.log("user.userid",n.userid),j()}),(s,e)=>(u(),d(U,null,[r.value?(u(),d("div",N," 讀取中 ")):m("",!0),x.value?(u(),d("div",z,[Z,t("p",null,[i("⚠️只允許申請單筆帳號您目前設定之身分證號"),t("span",A,P(a.value),1),i("為如需修改請洽本診所")]),M])):m("",!0),y.value?(u(),d("div",B,[L,t("form",{class:"flex flex-col items-center",onSubmit:e[1]||(e[1]=T(o=>V(),["prevent"]))},[S,W,X,H,g(t("input",{type:"text",id:"personid","onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o),pattern:"[A-Za-z][0-9]{9}",placeholder:"身分證號",class:"border border-gray-300 rounded-md px-2 py-1 mt-1",title:"請輸入有效的姓名（範例：F123456789）",required:""},null,512),[[k,a.value]]),G],32)])):m("",!0),h.value?(u(),d("div",J,[K,i(" 請問您是"),t("span",O,P(p.value),1),i("嗎？ "),t("button",{onClick:e[2]||(e[2]=o=>C()),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"是"),t("button",{onClick:e[3]||(e[3]=o=>{_.value=!0,h.value=!1}),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"否")])):m("",!0),_.value?(u(),d("div",Q,[R,i(" 請輸入基本資料，並且綁定本裝置。 "),g(t("input",{type:"text",id:"name","onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),pattern:"[A-Za-z]+",placeholder:"姓名",class:"border border-gray-300 rounded-md px-2 py-1 mt-1",title:"請輸入姓名",required:""},null,512),[[k,p.value]]),g(t("input",{type:"text",id:"phone","onUpdate:modelValue":e[5]||(e[5]=o=>f.value=o),pattern:"[0-9]+",placeholder:"聯絡電話",class:"border border-gray-300 rounded-md px-2 py-1 mt-1",title:"請輸入聯絡電話",required:""},null,512),[[k,f.value]]),t("button",{onClick:e[6]||(e[6]=o=>$()),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認"),t("button",{onClick:e[7]||(e[7]=o=>s.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"取消")])):m("",!0),w.value?(u(),d("div",Y,[ee,te,t("button",{onClick:e[8]||(e[8]=o=>s.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認")])):m("",!0),I.value?(u(),d("div",se,[le,oe,t("button",{onClick:e[9]||(e[9]=o=>s.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認")])):m("",!0)],64))}},ae={class:"text-xl"},ue={key:0,class:"text-center"},ie={__name:"Home",setup(D){const n=l(!1),c=l(null),a=l(null);q(async()=>{v.init({liffId:"1657869644-jDxqpoMV"}).then(()=>{v.isLoggedIn()&&(n.value=v.isLoggedIn(),c.value=v.getDecodedIDToken().sub,a.value=v.getDecodedIDToken().email)}).catch(f=>{console.log(f.code,f.message)})});const p=()=>{v.closeWindow()};return(f,x)=>(u(),d("div",ae,[n.value?(u(),d("p",ue)):m("",!0),E(ne,{onCloseWindow:p,userid:c.value},null,8,["userid"])]))}};export{ie as default};
