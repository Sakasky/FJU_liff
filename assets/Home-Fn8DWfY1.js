import{r as l,w as N,o as u,c as r,a as v,b as t,d as c,t as q,e as g,v as w,f as F,F as $,g as A,l as x,h as R}from"./index-BeaFRpZ9.js";import{a as y}from"./axios-Cm0UX6qg.js";const T={key:0,class:"flex items-center justify-center m-auto pt-10"},z={key:1,class:"flex items-center justify-center flex-col p-10 text-center"},E=t("p",null,"本裝置已經設定過",-1),U={class:"text-blue-500"},Z=t("p",null,[c("若需要預約請填寫"),t("a",{class:"text-blue-500 underline",href:"https://liff.line.me/1657869644-Z9PmDXzq"},"預約單")],-1),K={key:2,class:"flex items-center justify-center flex-col p-10 text-center"},B=t("h1",{class:"text-2xl font-bold text-center"},"問卷調查",-1),L=t("p",null,"歡迎您申請本系統👇 ",-1),W=t("p",null,"您的裝置尚未設定過身分證驗證 ",-1),X=t("p",null,"請直接輸入身分證號進行驗證(請使用大寫字母)",-1),H=t("label",{for:"name",class:"block mt-4"},[c("請問您的身分證號："),t("span",{class:"text-red-500 text-sm"},"＊")],-1),M=t("button",{type:"submit",class:"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded"},"送出",-1),O={key:3,class:"flex items-center justify-center flex-col p-10 text-center"},S=t("h1",{class:"text-2xl font-bold text-center"},"確認",-1),G={class:"text-blue-500"},J={key:4,class:"flex items-center justify-center flex-col p-10 text-center"},Q=t("h1",{class:"text-2xl font-bold text-center"},"基本資料與綁定裝置",-1),Y={key:5,class:"flex items-center justify-center flex-col p-10 text-center"},ee=t("p",null,"本裝置完成綁定",-1),te=t("p",null,[c("若需要預約請填寫"),t("a",{class:"text-blue-500 underline",href:"https://liff.line.me/1657869644-Z9PmDXzq"},"預約單")],-1),se={key:6,class:"flex items-center justify-center flex-col p-10 text-center"},le=t("p",null,"本裝置完成綁定",-1),oe=t("p",null,[c("若需要預約請填寫"),t("a",{class:"text-blue-500 underline",href:"https://liff.line.me/1657869644-Z9PmDXzq"},"預約單")],-1),ne={__name:"Survey",props:["userid"],setup(D){const n=D,i=l(null);console.log("userID",n);const a=l(""),p=l(""),m=l(""),h=l(!1),_=l(!1),f=l(!1),d=l(!0);l(!1);const b=l(!1),I=l(!1),k=l(!1),C=()=>{const s=new FormData;s.append("method","checkVIPisExist"),s.append("personid",a.value),s.append("userid",n.userid),d.value=!0,_.value=!1,y({method:"post",url:"https://script.google.com/macros/s/AKfycbxv0X4hKmjRsqICHL8WTa4nqpql6Rbq9w1njra_4jcFN-OcbZ4zxARyuyN9h2PCvvnB/exec",data:s,headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log("response",e),e.data.result==="personidisexist"?(i.value=e.data,d.value=!1,f.value=!0,p.value=e.data.personname):(d.value=!1,f.value=!1,b.value=!0)}).catch(e=>{console.log(e)})},P=()=>{const s=new FormData;s.append("method","addPersonVIP"),s.append("personid",a.value),s.append("userid",n.userid),d.value=!0,f.value=!1,y({method:"post",url:"https://script.google.com/macros/s/AKfycbxv0X4hKmjRsqICHL8WTa4nqpql6Rbq9w1njra_4jcFN-OcbZ4zxARyuyN9h2PCvvnB/exec",data:s,headers:{"Content-Type":"text/plain; charset=utf-8"}}).then(e=>{console.log(e.data),d.value=!1,k.value=!0}).catch(e=>{console.log(e)})},j=()=>{if(!p.value||!m.value){alert("請輸入姓名與電話");return}const s=new FormData;s.append("method","addPersonID"),s.append("personname",p.value),s.append("personphone",m.value),s.append("personid",a.value),s.append("userid",n.userid),d.value=!0,b.value=!1,y({method:"post",url:"https://script.google.com/macros/s/AKfycbxv0X4hKmjRsqICHL8WTa4nqpql6Rbq9w1njra_4jcFN-OcbZ4zxARyuyN9h2PCvvnB/exec",data:s,headers:{"Content-Type":"multipart/form-data"}}).then(e=>{i.value=e.data,console.log(e),d.value=!1,I.value=!0}).catch(e=>{console.log(e)})},V=()=>{const s=new FormData;s.append("method","checkUserIDisExist"),s.append("userid",n.userid),y({method:"post",url:"https://script.google.com/macros/s/AKfycbxv0X4hKmjRsqICHL8WTa4nqpql6Rbq9w1njra_4jcFN-OcbZ4zxARyuyN9h2PCvvnB/exec",data:s,headers:{"Content-Type":"text/plain; charset=utf-8"}}).then(e=>{e.data.result==="useridisexist"?(a.value=e.data.personid,i.value=e.data,console.log("personID",a),h.value=!0):(h.value=!1,_.value=!0,i.value=e.data),d.value=!1}).catch(e=>{console.log(e),i.value=e.data})};return N(n,(s,e)=>{console.log("user.userid",n.userid),V()}),(s,e)=>(u(),r($,null,[d.value?(u(),r("div",T," 讀取中 ")):v("",!0),h.value?(u(),r("div",z,[E,t("p",null,[c("⚠️只允許申請單筆帳號您目前設定之身分證號"),t("span",U,q(a.value),1),c("為如需修改請洽本診所")]),Z])):v("",!0),_.value?(u(),r("div",K,[B,t("form",{class:"flex flex-col items-center",onSubmit:e[1]||(e[1]=F(o=>C(),["prevent"]))},[L,W,X,H,g(t("input",{type:"text",id:"personid","onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o),pattern:"[A-Za-z][0-9]{9}",placeholder:"身分證號",class:"border border-gray-300 rounded-md px-2 py-1 mt-1",title:"請輸入有效的姓名（範例：F123456789）",required:""},null,512),[[w,a.value]]),M],32)])):v("",!0),f.value?(u(),r("div",O,[S,c(" 請問您是"),t("span",G,q(p.value),1),c("嗎？ "),t("button",{onClick:e[2]||(e[2]=o=>P()),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"是"),t("button",{onClick:e[3]||(e[3]=o=>{b.value=!0,f.value=!1}),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"否")])):v("",!0),b.value?(u(),r("div",J,[Q,c(" 請輸入基本資料，並且綁定本裝置。 "),g(t("input",{type:"text",id:"name","onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),pattern:"[A-Za-z]+",placeholder:"姓名",class:"border border-gray-300 rounded-md px-2 py-1 mt-1",title:"請輸入姓名",required:""},null,512),[[w,p.value]]),g(t("input",{type:"text",id:"phone","onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),pattern:"[0-9]+",placeholder:"聯絡電話",class:"border border-gray-300 rounded-md px-2 py-1 mt-1",title:"請輸入聯絡電話",required:""},null,512),[[w,m.value]]),t("button",{onClick:e[6]||(e[6]=o=>j()),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認"),t("button",{onClick:e[7]||(e[7]=o=>s.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"取消")])):v("",!0),I.value?(u(),r("div",Y,[ee,te,t("button",{onClick:e[8]||(e[8]=o=>s.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認")])):v("",!0),k.value?(u(),r("div",se,[le,oe,t("button",{onClick:e[9]||(e[9]=o=>s.$emit("close-window")),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded"},"確認")])):v("",!0)],64))}},ae={class:"text-xl"},ue={key:0,class:"text-center"},ce={__name:"Home",setup(D){const n=l(!1),i=l(null),a=l(null);A(async()=>{x.init({liffId:"1657869644-jDxqpoMV"}).then(()=>{x.isLoggedIn()&&(n.value=x.isLoggedIn(),i.value=x.getDecodedIDToken().sub,a.value=x.getDecodedIDToken().email)}).catch(m=>{console.log(m.code,m.message)})});const p=()=>{x.closeWindow()};return(m,h)=>(u(),r("div",ae,[n.value?(u(),r("p",ue)):v("",!0),R(ne,{onCloseWindow:p,userid:i.value},null,8,["userid"])]))}};export{ce as default};
